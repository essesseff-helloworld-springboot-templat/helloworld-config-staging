replicaCount: 2

image:
  registry: ghcr.io
  repository: essesseff-helloworld-springboot-templat/helloworld
  pullPolicy: IfNotPresent
  tag: 1.0.0-abc123-20250930T120000Z

imagePullSecrets:
  - name: ghcr-credentials

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/ROLE_NAME   # update this with actual AWS IAM role
    
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  enabled: false
  className: "alb"  # Changed from "nginx" to "alb"
  annotations:
    # AWS ALB Controller annotations
    alb.ingress.kubernetes.io/scheme: internal  # Use 'internet-facing' for public endpoint clusters
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
    
    # Group all environments into one ALB (cost-efficient)
    alb.ingress.kubernetes.io/group.name: helloworld
    alb.ingress.kubernetes.io/group.order: '3'  # Increment for each env (1=dev, 2=qa, 3=staging, 4=prod)
    
    # Health checks
    alb.ingress.kubernetes.io/healthcheck-path: /actuator/health   # Changed from /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '30'
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
    alb.ingress.kubernetes.io/healthy-threshold-count: '2'
    alb.ingress.kubernetes.io/unhealthy-threshold-count: '3'
    
    # SSL/TLS (if using ACM certificate - optional)
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:account:certificate/cert-id
    # alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    # alb.ingress.kubernetes.io/ssl-redirect: '443'
    
  hosts:
    - host: example.com  # Shared domain for all environments
      paths:
        - path: /helloworld-staging  # Path-based routing
          pathType: Prefix
  #        backend:
  #          service:
  #            name: helloworld-staging  # Must match your Service name
  #            port:
  #              number: 80  # Service port (not targetPort)
  
  # TLS configuration (optional - if using ACM certificate)
  # tls:
  #   - hosts:
  #       - example.com
  #     # secretName is auto-generated by ALB controller when using ACM

resources:
  limits:
    cpu: 400m
    memory: 512Mi
  requests:
    cpu: 200m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 75

livenessProbe:
  httpGet:
    path: /actuator/health/liveness   # Changed from /health
    port: 8080
  initialDelaySeconds: 30              # Increased from 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health/readiness   # Changed from /ready
    port: 8080
  initialDelaySeconds: 30              # Increased from 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

env:
  - name: ENVIRONMENT
    value: "STAGING"
  - name: PORT
    value: "8080"
  - name: VERSION
    value: "1.0.0-abc123-20250930T120000Z"

configMap:
  enabled: true
  data:
    app.config: |
      environment: staging
      logLevel: info
      features:
        experimental: false
